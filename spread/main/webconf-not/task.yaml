summary: Verify that firstboot won't run on a managed system
systems: [-ubuntu-core-16-64, -ubuntu-core-16-arm-64, -ubuntu-core-16-arm-32]
environment:
    SEED_DIR: /var/lib/snapd/seed
prepare: |
    systemctl stop snapd.service
    rm -f /var/lib/snapd/state.json
restore: |
    systemctl start snapd.service
execute: |
    echo "Start the daemon with an empty state, this will make it import "
    echo "assertions from the $SEED_DIR/assertions subdirectory."
    systemctl start snapd.service

    echo "The system should be managed already"
    test `snap managed`

    echo "Verifying that webconf is NOT running"
    test -z "`ps h -C webconf`"

    echo "Verifying that snapweb is running as normal"
    test -n "`ps h -C snapweb`"
