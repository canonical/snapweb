summary: Verify that webconf will start on an un-managed system by default
environment:
    SEED_DIR: /var/lib/snapd/seed
prepare: |
    systemctl stop snapd.service
    rm -f /var/lib/snapd/state.json
restore: |
    systemctl start snapd.service
execute: |
    echo "Start the daemon with an empty state, this will make it import "
    echo "assertions from the $SEED_DIR/assertions subdirectory."
    systemctl start snapd.service

    echo "The system should not be managed yet"
    test `snap managed` = 'false'

    echo "Verifying that snapweb is NOT running as normal"
    test `ps ax | grep -- -linux-gnu/snapweb | grep -v grep | grep -v web-conf | wc -l` -eq 0
    